<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <!-- Added viewport meta tag for proper responsive scaling on all devices -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AEP Health Monitoring – Last 24 Hours</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Custom Tailwind config to extend colors for logs -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'log-error-bg': '#2C1D1D', // A darker red background for error logs
            'log-error-border': '#EF4444', // Red for the left border (Tailwind red-500)
            'log-event-bg': '#1D232C', // A darker blue background for event logs
            'log-event-border': '#3B82F6', // Blue for the left border (Tailwind blue-500)
            'header-bg': '#1A202C', // Dark background for headers and modal
          }
        }
      }
    }
  </script>
</head>
<body class="bg-gray-900 text-white font-sans">
  <div class="max-w-6xl mx-auto p-4">
    <!-- Header Section -->
    <div class="flex justify-between items-center mb-4">
      <h1 class="text-3xl font-bold">AEP Health Monitoring <span class="text-sm font-normal text-gray-400">– Last 24 Hours</span></h1>
      <div class="flex items-center space-x-2">
        <span id="statusBadge" class="bg-red-600 text-xs px-2 py-1 rounded-md transition-colors duration-300">Disconnected</span>
        <button id="gearBtn" class="text-white text-xl focus:outline-none hover:text-gray-300">⚙️</button>
      </div>
    </div>

    <!-- Webhook URL Modal (Initially Hidden) -->
    <div id="modal" class="hidden bg-gray-800 border border-gray-700 p-4 rounded-lg mb-4">
      <p class="mb-2 font-semibold">Webhook URL:</p>
      <div class="flex items-center space-x-2">
        <code id="webhookUrl" class="text-blue-400 break-all bg-gray-900 p-2 rounded-md"></code>
        <button id="copyBtn" class="bg-blue-600 hover:bg-blue-700 text-white text-xs px-3 py-1.5 rounded-md font-semibold">Copy</button>
        <span id="copyStatus" class="text-green-400 text-xs hidden">Copied!</span>
      </div>
    </div>

    <!-- Chart Section -->
    <div class="bg-gray-800 p-4 rounded-lg shadow mb-6">
      <canvas id="barChart" height="100"></canvas>
    </div>

    <!-- Event Logs Section -->
    <div class="bg-gray-800 p-4 rounded-lg shadow">
      <!-- Event Logs Header with Accordion Toggle -->
      <div id="eventLogsHeader" class="flex justify-between items-center cursor-pointer mb-2">
        <h2 class="text-lg font-semibold">Event Logs <span id="logCount" class="text-gray-400">(0)</span></h2>
        <svg id="logsToggleArrow" class="w-5 h-5 text-gray-400 transform transition-transform duration-200 rotate-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
        </svg>
      </div>
      
      <div id="logContainer" class="max-h-96 overflow-y-auto space-y-2 pr-2"></div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // --- Element Caching ---
      const modal = document.getElementById('modal');
      const gearBtn = document.getElementById('gearBtn');
      const webhookUrlEl = document.getElementById('webhookUrl');
      const copyBtn = document.getElementById('copyBtn');
      const copyStatus = document.getElementById('copyStatus');
      const statusBadge = document.getElementById('statusBadge');
      const logContainer = document.getElementById('logContainer');
      const chartCanvas = document.getElementById('barChart');
      const logCountEl = document.getElementById('logCount');
      const eventLogsHeader = document.getElementById('eventLogsHeader'); 
      const logsToggleArrow = document.getElementById('logsToggleArrow'); 
      
      const displayedEventIds = new Set();
      const MAX_LOGS = 200; // Limit the number of log entries

      // --- Initial Setup ---
      webhookUrlEl.textContent = window.location.origin + "/webhook";

      // --- Event Listeners ---
      gearBtn.addEventListener('click', () => {
        modal.classList.toggle('hidden');
        copyStatus.classList.add('hidden'); // Hide status on toggle
      });

      copyBtn.addEventListener('click', () => {
        const textToCopy = webhookUrlEl.textContent;
        const textArea = document.createElement('textarea');
        textArea.value = textToCopy;
        document.body.appendChild(textArea);
        textArea.select();
        try {
          document.execCommand('copy');
          copyStatus.classList.remove('hidden');
          setTimeout(() => copyStatus.classList.add('hidden'), 2000);
        } catch (err) {
          console.error('Failed to copy text: ', err);
          // Fallback UI for error copying
        }
        document.body.removeChild(textArea);
      });

      // Toggle main log container visibility
      eventLogsHeader.addEventListener('click', () => {
        logContainer.classList.toggle('hidden');
        logsToggleArrow.classList.toggle('rotate-180'); // Rotate arrow on toggle
      });


      // --- Chart.js Initialization ---
      const ctx = chartCanvas.getContext('2d');
      const chart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: Array.from({ length: 24 }, (_, i) => {
            const date = new Date();
            date.setHours(date.getHours() - (23 - i));
            return `${date.getHours()}:00`;
          }),
          datasets: [
            {
              label: 'Events',
              data: Array(24).fill(0),
              backgroundColor: 'rgba(59, 130, 246, 0.7)',
              borderColor: 'rgb(59, 130, 246)',
              borderWidth: 1,
            },
            {
              label: 'Errors',
              data: Array(24).fill(0),
              backgroundColor: 'rgba(239, 68, 68, 0.7)',
              borderColor: 'rgb(239, 68, 68)',
              borderWidth: 1,
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: { 
              beginAtZero: true,
              ticks: { color: '#9CA3AF' },
              grid: { color: 'rgba(255, 255, 255, 0.1)' }
            },
            x: {
              ticks: { color: '#9CA3AF' },
              grid: { display: false }
            }
          },
          plugins: {
            legend: {
              labels: { color: '#E5E7EB' }
            }
          }
        }
      });

      // --- Data Fetching and UI Update Logic ---
      
      /**
       * Updates the status badge with the given text and style.
       * @param {('live'|'disconnected')} state - The current connection state.
       */
      const updateStatusBadge = (state) => {
        if (state === 'live') {
          statusBadge.textContent = 'Live';
          statusBadge.className = 'bg-green-600 text-xs px-2 py-1 rounded-md transition-colors duration-300';
        } else {
          statusBadge.textContent = 'Disconnected';
          statusBadge.className = 'bg-red-600 text-xs px-2 py-1 rounded-md transition-colors duration-300';
        }
      };

      /**
       * Safely gets a nested property from an object.
       * @param {object} obj - The object to traverse.
       * @param {string} path - The dot-separated path to the property.
       * @returns {*} The value of the property or undefined.
       */
      const getNestedProperty = (obj, path) => {
          return path.split('.').reduce((acc, part) => acc && acc[part], obj);
      };

      /**
       * Extracts error messages from the event object based on predefined paths.
       * @param {object} eventData - The 'event' object from the API response.
       * @returns {string[]} An array of unique error messages.
       */
      const extractErrorMessages = (eventData) => {
          const messages = new Set();
          const pathsToCheck = [
              'metrics.statusSummary.errors',
              'metrics.recordSummary.failedInfo',
              'metrics.recordSummary.skippedInfo', // Added to check for skipped events as errors/warnings
          ];
          
          // Check top-level paths
          pathsToCheck.forEach(path => {
              const errorsArray = getNestedProperty(eventData, path);
              if (Array.isArray(errorsArray)) {
                  errorsArray.forEach(err => {
                      if (err && err.message) messages.add(err.message);
                  });
              }
          });

          // Check paths within activities array
          const activities = getNestedProperty(eventData, 'activities');
          if (Array.isArray(activities)) {
              activities.forEach(activity => {
                  if (activity.statusSummary) {
                      const activityErrors = getNestedProperty(activity, 'statusSummary.errors');
                      if (Array.isArray(activityErrors)) {
                          activityErrors.forEach(err => {
                              if (err && err.message) messages.add(err.message);
                          });
                      }
                      const extensionErrors = getNestedProperty(activity, 'statusSummary.extensions.errors');
                      if (Array.isArray(extensionErrors)) {
                          extensionErrors.forEach(err => {
                              if (err && err.message) messages.add(err.message);
                          });
                      }
                      const errorDetail = getNestedProperty(activity, 'statusSummary.extensions.errorDetail');
                      if (typeof errorDetail === 'string' && errorDetail) {
                          messages.add(errorDetail);
                      }
                  }
                  const activityFailedInfo = getNestedProperty(activity, 'recordSummary.failedInfo');
                  if (Array.isArray(activityFailedInfo)) {
                      activityFailedInfo.forEach(info => {
                          if (info && info.message) messages.add(info.message);
                      });
                  }
                  const activitySkippedInfo = getNestedProperty(activity, 'recordSummary.skippedInfo');
                  if (Array.isArray(activitySkippedInfo)) {
                      activitySkippedInfo.forEach(info => {
                          if (info && info.message) messages.add(info.message);
                      });
                  }
              });
          }
          return Array.from(messages);
      };
      
      /**
       * Creates a DOM element for a log entry with accordion functionality.
       * @param {object} e - The event object from the API.
       * @returns {HTMLDivElement} - The created DOM element.
       */
      const createLogElement = (e) => {
          const dt = new Date(e.timestamp);
          const isError = e.isError;
          const logEntry = document.createElement('div');

          const borderColor = isError ? 'border-log-error-border' : 'border-log-event-border';
          const bgColor = isError ? 'bg-log-error-bg' : 'bg-log-event-bg';
          const statusColor = isError ? 'bg-red-600' : 'bg-blue-600';
          const statusText = isError ? 'Error' : 'Event';
          
          logEntry.className = `p-2 rounded-lg shadow-sm border-l-4 ${borderColor} ${bgColor} animate-fade-in`;

          let errorMessagesHtml = '';
          if (isError) {
              const messages = extractErrorMessages(e.event);
              if (messages.length > 0) {
                  errorMessagesHtml = messages.map(msg => `<p class="text-red-300 text-sm mt-1">${msg}</p>`).join('');
              } else {
                  errorMessagesHtml = `<p class="text-red-300 text-sm mt-1">An unknown error occurred or no specific error message found.</p>`;
              }
          }

          logEntry.innerHTML = `
            <div class="log-header flex items-center space-x-2 cursor-pointer py-1">
              <span class="text-gray-500 text-lg">ⓘ</span>
              <span class="px-2 py-0.5 text-xs rounded-md ${statusColor} font-semibold">${statusText}</span>
              <span class="text-gray-400 text-sm">${dt.toLocaleString()}</span>
            </div>
            ${errorMessagesHtml}
            <div class="log-content hidden mt-2 pt-2 border-t border-gray-700">
              <pre class="text-xs whitespace-pre-wrap text-gray-200">${JSON.stringify(e.event, null, 2)}</pre>
            </div>
          `;
          
          const header = logEntry.querySelector('.log-header');
          const content = logEntry.querySelector('.log-content');

          header.addEventListener('click', () => {
              content.classList.toggle('hidden');
          });

          return logEntry;
      };

      async function fetchEvents() {
        // Sample data based on your provided logs
        const sampleEventsData = [
          {
            timestamp: 1751040046000,
            event: {
              "event_id": "f11d90ba-e9c8-4c1d-97d2-2ae82257a2e5",
              "id": "1bf596a4-f6df-4bcb-91c4-3d431eb5b4ee",
              "createdAt": 1751029759016,
              "updatedAt": 1751040044298,
              "createdBy": "acp_foundation_connectors@AdobeID",
              "updatedBy": "acp_foundation_connectors@AdobeID",
              "createdClient": "acp_foundation_connectors",
              "updatedClient": "acp_foundation_connectors",
              "sandboxId": "4d5ee3d0-7e04-4849-9ee3-d07e0468494d",
              "sandboxName": "stage",
              "imsOrgId": "B1F65B5B54F62D0F0A4C98A2@AdobeOrg",
              "flowId": "d83b0c46-6569-4b3a-8750-4c7e07401b63",
              "providerRefId": "1751025600000-1751029200000",
              "etag": "\"93016c7d-0000-0d00-0000-685ec02c0000\"",
              "metrics": {
                "durationSummary": {
                  "startedAtUTC": 1751025600000,
                  "completedAtUTC": 1751040038000
                },
                "sizeSummary": {
                  "inputBytes": 170431,
                  "skippedBytes": 0
                },
                "recordSummary": {
                  "inputRecordCount": 19,
                  "skippedRecordCount": 0,
                  "failedRecordCount": 19,
                  "failedInfo": [
                    {
                      "code": "ACTSVC-8104-401",
                      "message": "Authentication error reported while pushing events to the destination. Please check authentication credentials and try again.",
                      "count": 19
                    }
                  ]
                },
                "statusSummary": {
                  "status": "failed",
                  "activityRefs": [
                    "af7dbd74-5662-11eb-ae93-0242ac130002"
                  ]
                }
              },
              "flowName": "Pinterest FR - 549759477381",
              "flowType": "streaming",
              "alertName": "Streaming Destinations Flow Run Completed",
              "message": "Pinterest FR - 549759477381 run which started at 2025-06-27 13:09:19 completed.",
              "url": "https://experience.adobe.com/@B1F65B5B54F62D0F0A4C98A2@AdobeOrg/sname:stage/platform/monitoring/dashboard?pageType=destination&flowId=d83b0c46-6569-4b3a-8750-4c7e07401b63&runId=1bf596a4-f6df-4bcb-91c4-3d431eb5b4ee&us_redirect=true"
            },
            "recipient_client_id": "3379cbc80d2c4f23b191875e55049810"
          },
          {
            timestamp: 1751040046000,
            event: {
              "event_id": "324adbe8-3349-4255-9774-f7ca92f35216",
              "id": "b7e4b11c-bf04-4097-bb79-b9934e67b2fc",
              "createdAt": 1751029878114,
              "updatedAt": 1751040045417,
              "createdBy": "acp_foundation_connectors@AdobeID",
              "updatedBy": "acp_foundation_connectors@AdobeID",
              "createdClient": "acp_foundation_connectors",
              "updatedClient": "acp_foundation_connectors",
              "sandboxId": "4d5ee3d0-7e04-4849-9ee3-d07e0468494d",
              "sandboxName": "stage",
              "imsOrgId": "B1F65B5B54F62D0F0A4C98A2@AdobeOrg",
              "flowId": "4dcbccbf-d99a-4c4c-93f0-c4d767e3faff",
              "providerRefId": "1751025600000-1751029200000",
              "etag": "\"93019f7d-0000-0d00-0000-685ec02d0000\"",
              "metrics": {
                "durationSummary": {
                  "startedAtUTC": 1751025600000,
                  "completedAtUTC": 1751040038000
                },
                "sizeSummary": {
                  "inputBytes": 66660,
                  "outputBytes": 0,
                  "skippedBytes": 0,
                  "failedBytes": 0,
                  "sourceSummaries": [
                    {
                      "id": "519632ed-0359-43f0-aff8-9125e91893dc",
                      "inputBytes": 66660,
                      "skippedBytes": 0,
                      "entitySummaries": [
                        {
                          "id": "segment:121c4554-ba50-4376-954f-c093174fa8d1",
                          "inputBytes": 12257,
                          "skippedBytes": 0
                        },
                        {
                          "id": "segment:b568e9a1-5a8d-4936-aaf3-81fa4fb45829",
                          "inputBytes": 5375,
                          "skippedBytes": 0
                        },
                        {
                          "id": "segment:b2373cc0-d34c-4b82-991f-97e39eb569d0",
                          "inputBytes": 12257,
                          "skippedBytes": 0
                        },
                        {
                          "id": "segment:780b1076-514d-4133-8ac2-081ab1861a33",
                          "inputBytes": 12257,
                          "skippedBytes": 0
                        },
                        {
                          "id": "segment:6d3d6601-0cd5-42e9-8992-a8fc9dd62100",
                          "inputBytes": 12257,
                          "skippedBytes": 0
                        },
                        {
                          "id": "segment:43f6a299-d080-434b-b031-112d33337be6",
                          "inputBytes": 12257,
                          "skippedBytes": 0
                        }
                      ]
                    }
                  ],
                  "targetSummaries": [
                    {
                      "id": "9bc4ff59-d5f9-4ebf-93c6-8216ac134691",
                      "outputBytes": 0,
                      "entitySummaries": [
                        {
                          "id": "segment:121c4554-ba50-4376-954f-c093174fa8d1",
                          "outputBytes": 0
                        },
                        {
                          "id": "segment:b568e9a1-5a8d-4936-aaf3-81fa4fb45829",
                          "outputBytes": 0
                        },
                        {
                          "id": "segment:b2373cc0-d34c-4b82-991f-97e39eb569d0",
                          "outputBytes": 0
                        },
                        {
                          "id": "segment:780b1076-514d-4133-8ac2-081ab1861a33",
                          "outputBytes": 0
                        },
                        {
                          "id": "segment:6d3d6601-0cd5-42e9-8992-a8fc9dd62100",
                          "outputBytes": 0
                        },
                        {
                          "id": "segment:43f6a299-d080-434b-b031-112d33337be6",
                          "outputBytes": 0
                        }
                      ]
                    }
                  ]
                },
                "recordSummary": {
                  "inputRecordCount": 2,
                  "createdRecordCount": 0,
                  "outputRecordCount": 0,
                  "skippedRecordCount": 0,
                  "failedRecordCount": 2,
                  "sourceSummaries": [
                    {
                      "id": "519632ed-0359-43f0-aff8-9125e91893dc",
                      "inputRecordCount": 2,
                      "skippedRecordCount": 0,
                      "entitySummaries": [
                        {
                          "id": "segment:121c4554-ba50-4376-954f-c093174fa8d1",
                          "inputRecordCount": 2,
                          "skippedRecordCount": 0,
                          "failedRecordCount": 0
                        },
                        {
                          "id": "segment:b568e9a1-5a8d-4936-aaf3-81fa4fb45829",
                          "inputRecordCount": 1,
                          "skippedRecordCount": 0,
                          "failedRecordCount": 0
                        },
                        {
                          "id": "segment:b2373cc0-d34c-4b82-991f-97e39eb569d0",
                          "inputRecordCount": 2,
                          "skippedRecordCount": 0,
                          "failedRecordCount": 0
                        },
                        {
                          "id": "segment:780b1076-514d-4133-8ac2-081ab1861a33",
                          "inputRecordCount": 2,
                          "skippedRecordCount": 0,
                          "failedRecordCount": 0
                        },
                        {
                          "id": "segment:6d3d6601-0cd5-42e9-8992-a8fc9dd62100",
                          "inputRecordCount": 2,
                          "skippedRecordCount": 0,
                          "failedRecordCount": 0
                        },
                        {
                          "id": "segment:43f6a299-d080-434b-b031-112d33337be6",
                          "inputRecordCount": 2,
                          "skippedRecordCount": 0,
                          "failedRecordCount": 0
                        }
                      ]
                    }
                  ],
                  "targetSummaries": [
                    {
                      "id": "9bc4ff59-d5f9-4ebf-93c6-8216ac134691",
                      "createdRecordCount": 0,
                      "outputRecordCount": 0,
                      "failedRecordCount": 2,
                      "entitySummaries": [
                        {
                          "id": "segment:121c4554-ba50-4376-954f-c093174fa8d1",
                          "createdRecordCount": 0,
                          "outputRecordCount": 0,
                          "failedRecordCount": 2
                        },
                        {
                          "id": "segment:b568e9a1-5a8d-4936-aaf3-81fa4fb45829",
                          "createdRecordCount": 0,
                          "outputRecordCount": 0,
                          "failedRecordCount": 1
                        },
                        {
                          "id": "segment:b2373cc0-d34c-4b82-991f-97e39eb569d0",
                          "createdRecordCount": 0,
                          "outputRecordCount": 0,
                          "failedRecordCount": 2
                        },
                        {
                          "id": "segment:780b1076-514d-4133-8ac2-081ab1861a33",
                          "createdRecordCount": 0,
                          "outputRecordCount": 0,
                          "failedRecordCount": 2
                        },
                        {
                          "id": "segment:6d3d6601-0cd5-42e9-8992-a8fc9dd62100",
                          "createdRecordCount": 0,
                          "outputRecordCount": 0,
                          "failedRecordCount": 2
                        },
                        {
                          "id": "segment:43f6a299-d080-434b-b031-112d33337be6",
                          "createdRecordCount": 0,
                          "outputRecordCount": 0,
                          "failedRecordCount": 2
                        }
                      ]
                    }
                  ],
                  "failedInfo": [
                    {
                      "code": "ACTSVC-8103-500",
                      "message": "An internal server error was reported by the destination while exporting data. Please contact your system administrator if the problem persists.",
                      "count": 2,
                      "type": "Error"
                    }
                  ]
                },
                "statusSummary": {
                  "status": "failed",
                  "activityRefs": [
                    "076085f8-255a-11ee-be56-0242ac120002"
                  ]
                }
              },
              "flowName": "PoC NN Confluent Rest Proxy",
              "flowType": "streaming",
              "alertName": "Streaming Destinations Flow Run Completed",
              "message": "PoC NN Confluent Rest Proxy run which started at 2025-06-27 13:11:18 completed.",
              "url": "https://experience.adobe.com/@B1F65B5B54F62D0F0A4C98A2@AdobeOrg/sname:stage/platform/monitoring/dashboard?pageType=destination&flowId=4dcbccbf-d99a-4c4c-93f0-c4d767e3faff&runId=b7e4b11c-bf04-4097-bb79-b9934e67b2fc&us_redirect=true"
            },
            "recipient_client_id": "3379cbc80d2c4f23b191875e55049810"
          },
          {
            timestamp: 1751040046000,
            event: {
              "event_id": "adf8de11-ec0c-4a64-8a5c-6ba04c351eb0",
              "id": "0b404270-be07-4dba-aaea-663f6e193f59",
              "createdAt": 1751029878973,
              "updatedAt": 1751040045573,
              "createdBy": "acp_foundation_connectors@AdobeID",
              "updatedBy": "acp_foundation_connectors@AdobeID",
              "createdClient": "acp_foundation_connectors",
              "updatedClient": "acp_foundation_connectors",
              "sandboxId": "4d5ee3d0-7e04-4849-9ee3-d07e0468494d",
              "sandboxName": "stage",
              "imsOrgId": "B1F65B5B54F62D0F0A4C98A2@AdobeOrg",
              "flowId": "00bfb08a-a037-4420-aa0c-48a95a18dee5",
              "providerRefId": "1751025600000-1751029200000",
              "etag": "\"9301a67d-0000-0d00-0000-685ec02d0000\"",
              "metrics": {
                "durationSummary": {
                  "startedAtUTC": 1751025600000,
                  "completedAtUTC": 1751040038000
                },
                "sizeSummary": {
                  "inputBytes": 66660,
                  "outputBytes": 0,
                  "skippedBytes": 0,
                  "failedBytes": 0,
                  "sourceSummaries": [
                    {
                      "id": "24f209a6-4abd-40bc-8627-7e863c39879e",
                      "inputBytes": 66660,
                      "skippedBytes": 0,
                      "entitySummaries": [
                        {
                          "id": "segment:121c4554-ba50-4376-954f-c093174fa8d1",
                          "inputBytes": 12257,
                          "skippedBytes": 0
                        },
                        {
                          "id": "segment:b568e9a1-5a8d-4936-aaf3-81fa4fb45829",
                          "inputBytes": 5375,
                          "skippedBytes": 0
                        },
                        {
                          "id": "segment:b2373cc0-d34c-4b82-991f-97e39eb569d0",
                          "inputBytes": 12257,
                          "skippedBytes": 0
                        },
                        {
                          "id": "segment:780b1076-514d-4133-8ac2-081ab1861a33",
                          "inputBytes": 12257,
                          "skippedBytes": 0
                        },
                        {
                          "id": "segment:6d3d6601-0cd5-42e9-8992-a8fc9dd62100",
                          "inputBytes": 12257,
                          "skippedBytes": 0
                        },
                        {
                          "id": "segment:43f6a299-d080-434b-b031-112d33337be6",
                          "inputBytes": 12257,
                          "skippedBytes": 0
                        }
                      ]
                    }
                  ],
                  "targetSummaries": [
                    {
                      "id": "91a33bdd-8c8e-49d7-b14e-4e1e7bd720e9",
                      "outputBytes": 0,
                      "entitySummaries": [
                        {
                          "id": "segment:121c4554-ba50-4376-954f-c093174fa8d1",
                          "outputBytes": 0
                        },
                        {
                          "id": "segment:b568e9a1-5a8d-4936-aaf3-81fa4fb45829",
                          "outputBytes": 0
                        },
                        {
                          "id": "segment:b2373cc0-d34c-4b82-991f-97e39eb569d0",
                          "outputBytes": 0
                        },
                        {
                          "id": "segment:780b1076-514d-4133-8ac2-081ab1861a33",
                          "outputBytes": 0
                        },
                        {
                          "id": "segment:6d3d6601-0cd5-42e9-8992-a8fc9dd62100",
                          "outputBytes": 0
                        },
                        {
                          "id": "segment:43f6a299-d080-434b-b031-112d33337be6",
                          "outputBytes": 0
                        }
                      ]
                    }
                  ]
                },
                "recordSummary": {
                  "inputRecordCount": 2,
                  "createdRecordCount": 0,
                  "outputRecordCount": 0,
                  "skippedRecordCount": 0,
                  "failedRecordCount": 2,
                  "sourceSummaries": [
                    {
                      "id": "24f209a6-4abd-40bc-8627-7e863c39879e",
                      "inputRecordCount": 2,
                      "skippedRecordCount": 0,
                      "entitySummaries": [
                        {
                          "id": "segment:121c4554-ba50-4376-954f-c093174fa8d1",
                          "inputRecordCount": 2,
                          "skippedRecordCount": 0,
                          "failedRecordCount": 0
                        },
                        {
                          "id": "segment:b568e9a1-5a8d-4936-aaf3-81fa4fb45829",
                          "inputRecordCount": 1,
                          "skippedRecordCount": 0,
                          "failedRecordCount": 0
                        },
                        {
                          "id": "segment:b2373cc0-d34c-4b82-991f-97e39eb569d0",
                          "inputRecordCount": 2,
                          "skippedRecordCount": 0,
                          "failedRecordCount": 0
                        },
                        {
                          "id": "segment:780b1076-514d-4133-8ac2-081ab1861a33",
                          "inputRecordCount": 2,
                          "skippedRecordCount": 0,
                          "failedRecordCount": 0
                        },
                        {
                          "id": "segment:6d3d6601-0cd5-42e9-8992-a8fc9dd62100",
                          "inputRecordCount": 2,
                          "skippedRecordCount": 0,
                          "failedRecordCount": 0
                        },
                        {
                          "id": "segment:43f6a299-d080-434b-b031-112d33337be6",
                          "inputRecordCount": 2,
                          "skippedRecordCount": 0,
                          "failedRecordCount": 0
                        }
                      ]
                    }
                  ],
                  "targetSummaries": [
                    {
                      "id": "91a33bdd-8c8e-49d7-b14e-4e1e7bd720e9",
                      "createdRecordCount": 0,
                      "outputRecordCount": 0,
                      "failedRecordCount": 2,
                      "entitySummaries": [
                        {
                          "id": "segment:121c4554-ba50-4376-954f-c093174fa8d1",
                          "createdRecordCount": 0,
                          "outputRecordCount": 0,
                          "failedRecordCount": 2
                        },
                        {
                          "id": "segment:b568e9a1-5a8d-4936-aaf3-81fa4fb45829",
                          "createdRecordCount": 0,
                          "outputRecordCount": 0,
                          "failedRecordCount": 1
                        },
                        {
                          "id": "segment:b2373cc0-d34c-4b82-991f-97e39eb569d0",
                          "createdRecordCount": 0,
                          "outputRecordCount": 0,
                          "failedRecordCount": 2
                        },
                        {
                          "id": "segment:780b1076-514d-4133-8ac2-081ab1861a33",
                          "createdRecordCount": 0,
                          "outputRecordCount": 0,
                          "failedRecordCount": 2
                        },
                        {
                          "id": "segment:6d3d6601-0cd5-42e9-8992-a8fc9dd62100",
                          "createdRecordCount": 0,
                          "outputRecordCount": 0,
                          "failedRecordCount": 2
                        },
                        {
                          "id": "segment:43f6a299-d080-434b-b031-112d33337be6",
                          "createdRecordCount": 0,
                          "outputRecordCount": 0,
                          "failedRecordCount": 2
                        }
                      ]
                    }
                  ],
                  "failedInfo": [
                    {
                      "code": "ACTSVC-8103-500",
                      "message": "An internal server error was reported by the destination while exporting data. Please contact your system administrator if the problem persists.",
                      "count": 2,
                      "type": "Error"
                    }
                  ]
                },
                "statusSummary": {
                  "status": "failed",
                  "activityRefs": [
                    "076085f8-255a-11ee-be56-0242ac120002"
                  ]
                }
              },
              "flowName": "Confluent PoC Test Number 3",
              "flowType": "streaming",
              "alertName": "Streaming Destinations Flow Run Completed",
              "message": "Confluent PoC Test Number 3 run which started at 2025-06-27 13:11:18 completed.",
              "url": "https://experience.adobe.com/@B1F65B5B54F62D0F0A4C98A2@AdobeOrg/sname:stage/platform/monitoring/dashboard?pageType=destination&flowId=00bfb08a-a037-4420-aa0c-48a95a18dee5&runId=0b404270-be07-4dba-aaea-663f6e193f59&us_redirect=true"
            },
            "recipient_client_id": "3379cbc80d2c4f23b191875e55049810"
          },
          {
            timestamp: 1751040046000,
            event: {
              "event_id": "167a525d-7440-4ac6-8fa8-89e3c2ffeb0c",
              "id": "1cf9643c-fa0c-45f5-95b7-b46a807c5871",
              "createdAt": 1751029871498,
              "updatedAt": 1751040044809,
              "createdBy": "acp_foundation_connectors@AdobeID",
              "updatedBy": "acp_foundation_connectors@AdobeID",
              "createdClient": "acp_foundation_connectors",
              "updatedClient": "acp_foundation_connectors",
              "sandboxId": "84f1bb64-4b8f-41ca-b1bb-644b8fc1ca19",
              "sandboxName": "stage1",
              "imsOrgId": "B1F65B5B54F62D0F0A4C98A2@AdobeOrg",
              "flowId": "ca975f0c-895f-4696-8088-eaaa137a76e2",
              "providerRefId": "1751025600000-1751029200000",
              "etag": "\"9301877d-0000-0d00-0000-685ec02c0000\"",
              "metrics": {
                "durationSummary": {
                  "startedAtUTC": 1751025600000,
                  "completedAtUTC": 1751040041000
                },
                "sizeSummary": {
                  "inputBytes": 138770,
                  "skippedBytes": 15836
                },
                "recordSummary": {
                  "inputRecordCount": 28,
                  "skippedRecordCount": 4,
                  "failedRecordCount": 24,
                  "skippedInfo": [
                    {
                      "code": "ACTSVC-8004-400",
                      "message": "No valid identities were found on the profile. This can indicate that several of the exported profiles are missing an identity attribute that was set as source field in the destination mapping. Please review the destination mapping and the identities on the exported profiles.",
                      "count": 4
                    }
                  ],
                  "failedInfo": [
                    {
                      "code": "ACTSVC-8104-401",
                      "message": "Authentication error reported while pushing events to the destination. Please check authentication credentials and try again.",
                      "count": 24
                    }
                  ]
                },
                "statusSummary": {
                  "status": "partialSuccess",
                  "activityRefs": [
                    "af7dbd74-5662-11eb-ae93-0242ac130002",
                    "f423ab04-2547-11ed-861d-0242ac120002"
                  ]
                }
              },
              "flowName": "Nespresso UK",
              "flowType": "streaming",
              "alertName": "Streaming Destinations Flow Run Completed",
              "message": "Nespresso UK run which started at 2025-06-27 13:11:11 completed.",
              "url": "https://experience.adobe.com/@B1F65B5B54F62D0F0A4C98A2@AdobeOrg/sname:stage1/platform/monitoring/dashboard?pageType=destination&flowId=ca975f0c-895f-4696-8088-eaaa137a76e2&runId=1cf9643c-fa0c-45f5-95b7-b46a807c5871&us_redirect=true"
            },
            "recipient_client_id": "3379cbc80d2c4f23b191875e55049810"
          },
          {
            timestamp: 1751040046000,
            event: {
              "event_id": "1c734839-3528-4461-a24b-ffb2c167db85",
              "id": "0884350a-f685-404a-aed2-9fb669da6e5c",
              "createdAt": 1751029791529,
              "updatedAt": 1751040044925,
              "createdBy": "acp_foundation_connectors@AdobeID",
              "updatedBy": "acp_foundation_connectors@AdobeID",
              "createdClient": "acp_foundation_connectors",
              "updatedClient": "acp_foundation_connectors",
              "sandboxId": "4d5ee3d0-7e04-4849-9ee3-d07e0468494d",
              "sandboxName": "stage",
              "imsOrgId": "B1F65B5B54F62D0F0A4C98A2@AdobeOrg",
              "flowId": "4a35ebe6-f398-4348-b63f-5edae9b5de58",
              "providerRefId": "1751025600000-1751029200000",
              "etag": "\"93018a7d-0000-0d00-0000-685ec02c0000\"",
              "metrics": {
                "durationSummary": {
                  "startedAtUTC": 1751025600000,
                  "completedAtUTC": 1751040038000
                },
                "sizeSummary": {
                  "inputBytes": 154328,
                  "outputBytes": 12916,
                  "skippedBytes": 0
                },
                "recordSummary": {
                  "inputRecordCount": 30,
                  "createdRecordCount": 30,
                  "outputRecordCount": 30,
                  "skippedRecordCount": 0,
                  "failedRecordCount": 0,
                  "failedInfo": [
                    {
                      "code": "ACTSVC-8105-400",
                      "message": "Bad request reported while pushing events to the destination. Please contact the administrator and try again.",
                      "count": 0
                    },
                    {
                      "code": "ACTSVC-8104-401",
                      "message": "Authentication error reported while pushing events to the destination. Please check authentication credentials and try again.",
                      "count": 0
                    }
                  ]
                },
                "statusSummary": {
                  "status": "partialSuccess",
                  "activityRefs": [
                    "af7dbd74-5662-11eb-ae93-0242ac130002"
                  ]
                }
              },
              "activities": [
                {
                  "id": "f423ab04-2547-11ed-861d-0242ac120002",
                  "name": "Activation Spark Activity",
                  "updatedAtUTC": 0,
                  "durationSummary": {
                    "startedAtUTC": 1751025962580,
                    "completedAtUTC": 1751031018651
                  },
                  "latencySummary": {},
                  "sizeSummary": {
                    "inputBytes": 154328,
                    "outputBytes": 21956,
                    "skippedBytes": 0
                  },
                  "recordSummary": {
                    "inputRecordCount": 30,
                    "createdRecordCount": 30,
                    "outputRecordCount": 30,
                    "skippedRecordCount": 0,
                    "failedRecordCount": 0
                  },
                  "fileSummary": {},
                  "statusSummary": {
                    "status": "success",
                    "extensions": {}
                  }
                },
                {
                  "id": "af7dbd74-5662-11eb-ae93-0242ac130002",
                  "name": "Iris Realtime Activity",
                  "updatedAtUTC": 0,
                  "durationSummary": {
                    "startedAtUTC": 1751025600000,
                    "completedAtUTC": 1751036399999
                  },
                  "latencySummary": {},
                  "sizeSummary": {
                    "inputBytes": 0,
                    "outputBytes": 12916
                  },
                  "recordSummary": {
                    "inputRecordCount": 30,
                    "createdRecordCount": 30,
                    "outputRecordCount": 30,
                    "skippedRecordCount": 0,
                    "failedRecordCount": 0,
                    "failedInfo": [
                      {
                        "code": "ACTSVC-8105-400",
                        "message": "Bad request reported while pushing events to the destination. Please contact the administrator and try again.",
                        "count": 0
                      },
                      {
                        "code": "ACTSVC-8104-401",
                        "message": "Authentication error reported while pushing events to the destination. Please check authentication credentials and try again.",
                        "count": 0
                      }
                    ]
                  },
                  "fileSummary": {},
                  "statusSummary": {
                    "status": "success",
                    "extensions": {}
                  }
                }
              ],
              "flowName": "[CH - VST] Customer Selection",
              "flowType": "",
              "alertName": "Destination Flow Run Success"
            },
            "recipient_client_id": "3379cbc80d2c4f23b191875e55049810"
          },
          {
            timestamp: 1751040046000,
            event: {
              "event_id": "5921f308-f027-4fd1-b40e-db9c3673dd4f",
              "id": "efe8af3c-3fcf-41ba-ba02-7d792dd22de3",
              "createdAt": 1751029842890,
              "updatedAt": 1751040045146,
              "createdBy": "acp_foundation_connectors@AdobeID",
              "updatedBy": "acp_foundation_connectors@AdobeID",
              "createdClient": "acp_foundation_connectors",
              "updatedClient": "acp_foundation_connectors",
              "sandboxId": "4d5ee3d0-7e04-4849-9ee3-d07e0468494d",
              "sandboxName": "stage",
              "imsOrgId": "B1F65B5B54F62D0F0A4C98A2@AdobeOrg",
              "flowId": "2356acbe-4196-4758-bac2-4956f99a41a0",
              "providerRefId": "1751025600000-1751029200000",
              "etag": "\"9301947d-0000-0d00-0000-685ec02d0000\"",
              "metrics": {
                "durationSummary": {
                  "startedAtUTC": 1751025600000,
                  "completedAtUTC": 1751040038000
                },
                "sizeSummary": {
                  "inputBytes": 170431,
                  "skippedBytes": 0
                },
                "recordSummary": {
                  "inputRecordCount": 19,
                  "skippedRecordCount": 0,
                  "failedRecordCount": 19,
                  "failedInfo": [
                    {
                      "code": "ACTSVC-8104-401",
                      "message": "Authentication error reported while pushing events to the destination. Please check authentication credentials and try again.",
                      "count": 19
                    }
                  ]
                },
                "statusSummary": {
                  "status": "failed",
                  "activityRefs": [
                    "af7dbd74-5662-11eb-ae93-0242ac130002"
                  ]
                }
              },
              "flowName": "Pinterest CH - 549763403104",
              "flowType": "streaming",
              "alertName": "Streaming Destinations Flow Run Completed",
              "message": "Pinterest CH - 549763403104 run which started at 2025-06-27 13:10:42 completed.",
              "url": "https://experience.adobe.com/@B1F65B5B54F62D0F0A4C98A2@AdobeOrg/sname:stage/platform/monitoring/dashboard?pageType=destination&flowId=2356acbe-4196-4758-bac2-4956f99a41a0&runId=efe8af3c-3fcf-41ba-ba02-7d792dd22de3&us_redirect=true"
            },
            "recipient_client_id": "3379cbc80d2c4f23b191875e55049810"
          },
          {
            timestamp: 1751040046000,
            event: {
              "event_id": "aedca0cc-4e7b-4a94-8a3b-0bfdb6d73a32",
              "id": "063df640-c820-46b7-a842-a992d6b23340",
              "createdAt": 1751029877861,
              "updatedAt": 1751040045284,
              "createdBy": "acp_foundation_connectors@AdobeID",
              "updatedBy": "acp_foundation_connectors@AdobeID",
              "createdClient": "acp_foundation_connectors",
              "updatedClient": "acp_foundation_connectors",
              "sandboxId": "4d5ee3d0-7e04-4849-9ee3-d07e0468494d",
              "sandboxName": "stage",
              "imsOrgId": "B1F65B5B54F62D0F0A4C98A2@AdobeOrg",
              "flowId": "1ffd5312-3dbc-4dff-b078-ae33981f4519",
              "providerRefId": "1751025600000-1751029200000",
              "etag": "\"93019a7d-0000-0d00-0000-685ec02d0000\"",
              "metrics": {
                "durationSummary": {
                  "startedAtUTC": 1751025600000,
                  "completedAtUTC": 1751040038000
                },
                "sizeSummary": {
                  "inputBytes": 66660,
                  "outputBytes": 0,
                  "skippedBytes": 0,
                  "failedBytes": 0,
                  "sourceSummaries": [
                    {
                      "id": "d23abcfe-16d3-44fa-991e-8def23be7f85",
                      "inputBytes": 66660,
                      "skippedBytes": 0,
                      "entitySummaries": [
                        {
                          "id": "segment:121c4554-ba50-4376-954f-c093174fa8d1",
                          "inputBytes": 12257,
                          "skippedBytes": 0
                        },
                        {
                          "id": "segment:b568e9a1-5a8d-4936-aaf3-81fa4fb45829",
                          "inputBytes": 5375,
                          "skippedBytes": 0
                        },
                        {
                          "id": "segment:b2373cc0-d34c-4b82-991f-97e39eb569d0",
                          "inputBytes": 12257,
                          "skippedBytes": 0
                        },
                        {
                          "id": "segment:780b1076-514d-4133-8ac2-081ab1861a33",
                          "inputBytes": 12257,
                          "skippedBytes": 0
                        },
                        {
                          "id": "segment:6d3d6601-0cd5-42e9-8992-a8fc9dd62100",
                          "inputBytes": 12257,
                          "skippedBytes": 0
                        },
                        {
                          "id": "segment:43f6a299-d080-434b-b031-112d33337be6",
                          "inputBytes": 12257,
                          "skippedBytes": 0
                        }
                      ]
                    }
                  ],
                  "targetSummaries": [
                    {
                      "id": "c2f83dba-8140-4bb6-b908-95da27f2284e",
                      "outputBytes": 0,
                      "entitySummaries": [
                        {
                          "id": "segment:121c4554-ba50-4376-954f-c093174fa8d1",
                          "outputBytes": 0
                        },
                        {
                          "id": "segment:b568e9a1-5a8d-4936-aaf3-81fa4fb45829",
                          "outputBytes": 0
                        },
                        {
                          "id": "segment:b2373cc0-d34c-4b82-991f-97e39eb569d0",
                          "outputBytes": 0
                        },
                        {
                          "id": "segment:780b1076-514d-4133-8ac2-081ab1861a33",
                          "outputBytes": 0
                        },
                        {
                          "id": "segment:6d3d6601-0cd5-42e9-8992-a8fc9dd62100",
                          "outputBytes": 0
                        },
                        {
                          "id": "segment:43f6a299-d080-434b-b031-112d33337be6",
                          "outputBytes": 0
                        }
                      ]
                    }
                  ]
                },
                "recordSummary": {
                  "inputRecordCount": 2,
                  "createdRecordCount": 0,
                  "outputRecordCount": 0,
                  "skippedRecordCount": 0,
                  "failedRecordCount": 2,
                  "sourceSummaries": [
                    {
                      "id": "d23abcfe-16d3-44fa-991e-8def23be7f85",
                      "inputRecordCount": 2,
                      "skippedRecordCount": 0,
                      "entitySummaries": [
                        {
                          "id": "segment:121c4554-ba50-4376-954f-c093174fa8d1",
                          "inputRecordCount": 2,
                          "skippedRecordCount": 0,
                          "failedRecordCount": 0
                        },
                        {
                          "id": "segment:b568e9a1-5a8d-4936-aaf3-81fa4fb45829",
                          "inputRecordCount": 1,
                          "skippedRecordCount": 0,
                          "failedRecordCount": 0
                        },
                        {
                          "id": "segment:b2373cc0-d34c-4b82-991f-97e39eb569d0",
                          "inputRecordCount": 2,
                          "skippedRecordCount": 0,
                          "failedRecordCount": 0
                        },
                        {
                          "id": "segment:780b1076-514d-4133-8ac2-081ab1861a33",
                          "inputRecordCount": 2,
                          "skippedRecordCount": 0,
                          "failedRecordCount": 0
                        },
                        {
                          "id": "segment:6d3d6601-0cd5-42e9-8992-a8fc9dd62100",
                          "inputRecordCount": 2,
                          "skippedRecordCount": 0,
                          "failedRecordCount": 0
                        },
                        {
                          "id": "segment:43f6a299-d080-434b-b031-112d33337be6",
                          "inputRecordCount": 2,
                          "skippedRecordCount": 0,
                          "failedRecordCount": 0
                        }
                      ]
                    }
                  ],
                  "targetSummaries": [
                    {
                      "id": "c2f83dba-8140-4bb6-b908-95da27f2284e",
                      "createdRecordCount": 0,
                      "outputRecordCount": 0,
                      "failedRecordCount": 2,
                      "entitySummaries": [
                        {
                          "id": "segment:121c4554-ba50-4376-954f-c093174fa8d1",
                          "createdRecordCount": 0,
                          "outputRecordCount": 0,
                          "failedRecordCount": 2
                        },
                        {
                          "id": "segment:b568e9a1-5a8d-4936-aaf3-81fa4fb45829",
                          "createdRecordCount": 0,
                          "outputRecordCount": 0,
                          "failedRecordCount": 1
                        },
                        {
                          "id": "segment:b2373cc0-d34c-4b82-991f-97e39eb569d0",
                          "createdRecordCount": 0,
                          "outputRecordCount": 0,
                          "failedRecordCount": 2
                        },
                        {
                          "id": "segment:780b1076-514d-4133-8ac2-081ab1861a33",
                          "createdRecordCount": 0,
                          "outputRecordCount": 0,
                          "failedRecordCount": 2
                        },
                        {
                          "id": "segment:6d3d6601-0cd5-42e9-8992-a8fc9dd62100",
                          "createdRecordCount": 0,
                          "outputRecordCount": 0,
                          "failedRecordCount": 2
                        },
                        {
                          "id": "segment:43f6a299-d080-434b-b031-112d33337be6",
                          "createdRecordCount": 0,
                          "outputRecordCount": 0,
                          "failedRecordCount": 2
                        }
                      ]
                    }
                  ],
                  "failedInfo": [
                    {
                      "code": "ACTSVC-8103-500",
                      "message": "An internal server error was reported by the destination while exporting data. Please contact your system administrator if the problem persists.",
                      "count": 2,
                      "type": "Error"
                    }
                  ]
                },
                "statusSummary": {
                  "status": "failed",
                  "activityRefs": [
                    "076085f8-255a-11ee-be56-0242ac120002"
                  ]
                }
              },
              "flowName": "PoCEventHubsV1",
              "flowType": "streaming",
              "alertName": "Streaming Destinations Flow Run Completed",
              "message": "PoCEventHubsV1 run which started at 2025-06-27 13:11:17 completed.",
              "url": "https://experience.adobe.com/@B1F65B5B54F62D0F0A4C98A2@AdobeOrg/sname:stage/platform/monitoring/dashboard?pageType=destination&flowId=1ffd5312-3dbc-4dff-b078-ae33981f4519&runId=063df640-c820-46b7-a842-a992d6b23340&us_redirect=true"
            },
            "recipient_client_id": "3379cbc80d2c4f23b191875e55049810"
          },
          {
            timestamp: 1751040046000,
            event: {
              "event_id": "160a850e-24fc-440d-a5b0-99c78c56e764",
              "id": "ffda3a7a-aeac-4a35-bee7-4cbcf893d766",
              "createdAt": 1751026549160,
              "updatedAt": 1751040045127,
              "createdBy": "acp_foundation_connectors@AdobeID",
              "updatedBy": "acp_foundation_connectors@AdobeID",
              "createdClient": "acp_foundation_connectors",
              "updatedClient": "acp_foundation_connectors",
              "sandboxId": "7e644271-e188-499a-a442-71e188199a17",
              "sandboxName": "ch",
              "imsOrgId": "B1F65B5B54F62D0F0A4C98A2@AdobeOrg",
              "flowId": "4e95db21-3e1c-4111-a0a3-e878b87f011b",
              "providerRefId": "1751025600000-1751029200000",
              "etag": "\"a4066069-0000-0d00-0000-685ec02d0000\"",
              "metrics": {
                "durationSummary": {
                  "startedAtUTC": 1751025600000,
                  "completedAtUTC": 1751040043000
                },
                "sizeSummary": {
                  "inputBytes": 14046857,
                  "outputBytes": 870886,
                  "skippedBytes": 411817
                },
                "recordSummary": {
                  "inputRecordCount": 1378,
                  "createdRecordCount": 1463,
                  "outputRecordCount": 1463,
                  "skippedRecordCount": 73,
                  "failedRecordCount": 1884,
                  "skippedInfo": [
                    {
                      "code": "ACTSVC-8004-400",
                      "message": "No valid identities were found on the profile. This can indicate that several of the exported profiles are missing an identity attribute that was set as source field in the destination mapping. Please review the destination mapping and the identities on the exported profiles.",
                      "count": 73
                    }
                  ],
                  "failedInfo": [
                    {
                      "code": "ACTSVC-8109-503",
                      "message": "Default error response. Uncaught error reported while pushing events to the destination. Please contact the administrator and try again.",
                      "count": 1884
                    }
                  ]
                },
                "statusSummary": {
                  "status": "partialSuccess",
                  "activityRefs": [
                    "af7dbd74-5662-11eb-ae93-0242ac130002",
                    "f423ab04-2547-11ed-861d-0242ac120002"
                  ]
                }
              },
              "flowName": "Google DV360 - CH",
              "flowType": "streaming",
              "alertName": "Streaming Destinations Flow Run Completed",
              "message": "Google DV360 - CH run which started at 2025-06-27 12:15:49 completed.",
              "url": "https://experience.adobe.com/@B1F65B5B54F62D0F0A4C98A2@AdobeOrg/sname:ch/platform/monitoring/dashboard?pageType=destination&flowId=4e95db21-3e1c-4111-a0a3-e878b87f011b&runId=ffda3a7a-aeac-4a35-bee7-4cbcf893d766&us_redirect=true"
            },
            "recipient_client_id": "3379cbc80d2c4f23b191875e55049810"
          }
        ];

        try {
          // Replace the fetch call with direct use of sample data
          const data = sampleEventsData;

          const perHourEvents = Array(24).fill(0);
          const perHourErrors = Array(24).fill(0);
          const nowTime = Date.now();
          let recentActivity = false;

          const newLogs = [];
          data.forEach(e => {
            // Use event.id if available, otherwise timestamp
            const eventId = e.event.id || e.timestamp; 
            
            const hourDiff = Math.floor((nowTime - e.timestamp) / 3600000);
            if (hourDiff < 24) {
              const index = 23 - hourDiff;

              // Determine if it's an error based on status or extracted messages
              const hasErrorMessages = extractErrorMessages(e.event).length > 0;
              const isFailedStatus = e.event.metrics && e.event.metrics.statusSummary && 
                                     (e.event.metrics.statusSummary.status === 'failed' || 
                                      e.event.metrics.statusSummary.status === 'partialSuccess');
              
              e.isError = hasErrorMessages || isFailedStatus; // Assign isError flag to the event object
              
              if (e.isError) {
                perHourErrors[index]++;
              } else {
                perHourEvents[index]++;
              }

              if (!displayedEventIds.has(eventId)) {
                  newLogs.push(e);
                  displayedEventIds.add(eventId);
              }
            }
            if (nowTime - e.timestamp < 2 * 60 * 1000) {
              recentActivity = true;
            }
          });
          
          newLogs.reverse().forEach(logData => {
            const logElement = createLogElement(logData);
            logContainer.prepend(logElement);
          });
          
          while (logContainer.children.length > MAX_LOGS) { 
              logContainer.removeChild(logContainer.lastChild);
          }
          logCountEl.textContent = `(${logContainer.children.length})`;


          chart.data.datasets[0].data = perHourEvents;
          chart.data.datasets[1].data = perHourErrors;
          chart.update('none'); 

          updateStatusBadge(recentActivity ? 'live' : 'disconnected');

        } catch (error) {
          console.error("Failed to fetch or process events:", error);
          updateStatusBadge('disconnected');
        }
      }

      // Initial call and interval setup
      fetchEvents();
      // setInterval(fetchEvents, 5000); // Commented out to prevent continuous fetching of static data
    });
  </script>
  
  <!-- Simple CSS animation for new log entries -->
  <style>
    @keyframes fade-in {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .animate-fade-in {
      animation: fade-in 0.5s ease-out forwards;
    }
    /* Custom scrollbar styling to match dark theme */
    #logContainer::-webkit-scrollbar {
      width: 8px;
    }
    #logContainer::-webkit-scrollbar-track {
      background: #1A202C; /* Darker background for the track */
      border-radius: 10px;
    }
    #logContainer::-webkit-scrollbar-thumb {
      background: #4A5568; /* Grayish thumb */
      border-radius: 10px;
    }
    #logContainer::-webkit-scrollbar-thumb:hover {
      background: #667EEA; /* Lighter on hover */
    }
  </style>
</body>
</html>
